<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Management Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="header-title" style="text-align: left;">
                    <h1 style="font-size: 2rem;">Event Management System</h1>
                    <p style="color: var(--text-secondary); margin-top: 5px;">Manage all your events in one place</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">üåì</button>
                <button onclick="logout()" class="logout-btn">Logout</button>
            </div>
        </div>

        <div id="loginSection" class="login-section">
            <div class="login-card">
                <h2>Admin Login</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                    </div>
                    <button type="submit" class="btn-primary">Login</button>
                </form>
            </div>
        </div>

        <div id="dashboardContent" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Events</h3>
                    <p class="stat-number" id="totalEvents">0</p>
                </div>
                <div class="stat-card">
                    <h3>Active Events</h3>
                    <p class="stat-number" id="activeEvents">0</p>
                </div>
                <div class="stat-card">
                    <h3>Total Participants</h3>
                    <p class="stat-number" id="totalParticipants">0</p>
                </div>
                <div class="stat-card">
                    <h3>Checked In</h3>
                    <p class="stat-number" id="totalCheckedIn">0</p>
                </div>
            </div>

            <div class="events-section">
                <div class="section-header">
                    <h2>Events</h2>
                </div>
                <div id="eventsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading events...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'todak1q2w3e';

        // Check login status
        function checkLogin() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                loadEvents();
            } else {
                document.getElementById('loginSection').style.display = 'flex';
                document.getElementById('dashboardContent').style.display = 'none';
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                checkLogin();
            } else {
                alert('Incorrect password');
            }
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            checkLogin();
        }

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // Load events from API
        async function loadEvents() {
            try {
                const response = await fetch('/api/get-events');
                const result = await response.json();

                if (result.success) {
                    displayEvents(result.events);
                    updateStats(result.events);
                } else {
                    console.error('Failed to load events:', result.error);
                    document.getElementById('eventsContainer').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚ö†Ô∏è</div>
                            <p>Failed to load events: ${result.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('eventsContainer').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p>Error loading events. Please try again.</p>
                    </div>
                `;
            }
        }

        function displayEvents(events) {
            const container = document.getElementById('eventsContainer');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="events-grid">
                        <div class="create-event-card" onclick="createNewEvent()">
                            <div class="create-icon">+</div>
                            <div class="create-text">Create Your First Event</div>
                        </div>
                    </div>
                `;
                return;
            }

            const eventsHTML = events.map(event => `
                <div class="event-card">
                    <div class="event-card-header">
                        <div>
                            <div class="event-card-title">${event.name}</div>
                        </div>
                        <span class="event-badge ${event.isActive ? '' : 'inactive'}">
                            ${event.isActive ? 'Active' : 'Inactive'}
                        </span>
                    </div>
                    <div class="event-meta">
                        <div class="event-meta-item">
                            üìÖ ${formatDate(event.date)}
                        </div>
                        ${event.venue ? `<div class="event-meta-item">üìç ${event.venue}</div>` : ''}
                        <div class="event-meta-item">
                            üé≠ ${event.eventType || 'Event'}
                        </div>
                    </div>
                    <div class="event-stats">
                        <div class="event-stat">
                            <div class="event-stat-value">${event.participantCount}</div>
                            <div class="event-stat-label">Guests</div>
                        </div>
                        <div class="event-stat">
                            <div class="event-stat-value">${event.checkedInCount}</div>
                            <div class="event-stat-label">Checked In</div>
                        </div>
                        <div class="event-stat">
                            <div class="event-stat-value">${event.tableCount}</div>
                            <div class="event-stat-label">Tables</div>
                        </div>
                    </div>
                    <div class="event-actions">
                        <a href="event-manage.html?id=${event.id}" class="btn-manage">Manage</a>
                        <a href="checkin.html?event=${event.id}" class="btn-view" target="_blank">View</a>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="events-grid">
                    ${eventsHTML}
                    <div class="create-event-card" onclick="createNewEvent()">
                        <div class="create-icon">+</div>
                        <div class="create-text">Create New Event</div>
                    </div>
                </div>
            `;
        }

        function updateStats(events) {
            const totalEvents = events.length;
            const activeEvents = events.filter(e => e.isActive).length;
            const totalParticipants = events.reduce((sum, e) => sum + e.participantCount, 0);
            const totalCheckedIn = events.reduce((sum, e) => sum + e.checkedInCount, 0);

            document.getElementById('totalEvents').textContent = totalEvents;
            document.getElementById('activeEvents').textContent = activeEvents;
            document.getElementById('totalParticipants').textContent = totalParticipants;
            document.getElementById('totalCheckedIn').textContent = totalCheckedIn;
        }

        function formatDate(dateString) {
            if (!dateString) return 'No date set';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function createNewEvent() {
            window.location.href = 'event-wizard.html';
        }

        // Initialize
        loadTheme();
        checkLogin();
    </script>
</body>
</html>
